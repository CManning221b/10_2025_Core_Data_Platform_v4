{% extends 'base/base.html' %}

{% block title %}Upload Data - Graph Visualization System{% endblock %}

{% block content %}
<h1>Upload Data for Visualization</h1>

<div class="upload-container">
    <p class="instructions">
        Choose a method to upload your graph data for visualization.
    </p>

    <div class="method-selector">
        <div class="form-group">
            <label for="upload-method">Select Upload Method:</label>
            <select id="upload-method" class="form-control">
                <option value="file">File Upload</option>
                <option value="dataframe">DataFrame Upload</option>
                <option value="paths">Path List</option>
                <option value="directory">Directory</option>
                <option value="json">JSON Input</option>
            </select>
        </div>
    </div>

    <div class="method-forms">
        <!-- File Upload Form -->
        <div class="method-form" id="file-form">
            <form action="{{ url_for('upload.process_file_upload') }}" method="post" enctype="multipart/form-data" class="upload-form">
                <div class="form-group">
                    <label for="file">Select File:</label>
                    <input type="file" id="file" name="file" accept=".csv,.json">
                </div>

                <div class="form-group">
                    <label for="graph_type">Graph Type:</label>
                    <select id="graph_type" name="graph_type" class="form-control">
                        <option value="directed">Directed Graph</option>
                        <option value="undirected">Undirected Graph</option>
                        <option value="auto">Auto-detect</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="layout">Initial Layout:</label>
                    <select id="layout" name="layout" class="form-control">
                        <option value="force">Force-directed</option>
                        <option value="circular">Circular</option>
                        <option value="hierarchical">Hierarchical</option>
                        <option value="random">Random</option>
                    </select>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Upload &amp; Process</button>
                </div>
            </form>

            <div class="upload-help">
                <h3>File Format Guidelines</h3>
                <p>For best results, please ensure your data file adheres to the following guidelines:</p>
                <ul>
                    <li><strong>CSV files:</strong> Should contain source and target columns for edges</li>
                    <li><strong>JSON files:</strong> Should follow standard graph JSON format with nodes and edges arrays</li>
                </ul>
            </div>
        </div>

        <!-- DataFrame Upload Form -->
        <div class="method-form" id="dataframe-form" style="display: none;">
            <form action="{{ url_for('upload.process_dataframe_upload') }}" method="post" enctype="multipart/form-data" class="upload-form">
                <div class="form-group">
                    <label for="dataframe_file">Upload DataFrame CSV:</label>
                    <input type="file" id="dataframe_file" name="dataframe_file" accept=".csv" required>
                    <small class="form-text text-muted">CSV file containing data to be visualized as a graph</small>
                </div>

                <div class="form-group">
                    <label for="metadata_file">Upload Metadata CSV:</label>
                    <input type="file" id="metadata_file" name="metadata_file" accept=".csv" required>
                    <small class="form-text text-muted">CSV file containing metadata for graph construction</small>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Upload &amp; Process</button>
                </div>
            </form>

            <div class="upload-help">
                <h3>DataFrame and Metadata Guidelines</h3>
                <p>For successful DataFrame-based visualization, please ensure your files adhere to the following guidelines:</p>
                <ul>
                    <li><strong>DataFrame CSV:</strong> Any tabular data structure to be visualized as a graph</li>
                    <li><strong>Metadata CSV:</strong> Should include these columns:
                        <ul>
                            <li><code>column</code>: The name of a column in your DataFrame</li>
                            <li><code>node_type</code>: The type of node to create from this column</li>
                            <li><code>hierarchy_level</code>: Node position in the hierarchy (numeric)</li>
                            <li><code>edge_type</code>: The type/label of edges connected to this column</li>
                            <li><code>direction</code>: Edge direction ('in' or 'out')</li>
                            <li><code>connects_to</code>: Target column name to connect to, or 'central' for hub nodes</li>
                        </ul>
                    </li>
                </ul>
                <p>Example metadata for a product orders dataset:</p>
                <pre class="example">
column,node_type,hierarchy_level,edge_type,direction,connects_to
customer_id,customer,1,purchased,out,order_id
order_id,order,2,contains,out,product_id
product_id,product,3,belongs_to,in,category
category,category,4,has_product,in,product_id
                </pre>
            </div>
        </div>

        <!-- Path List Form -->
        <div class="method-form" id="paths-form" style="display: none;">
            <form action="{{ url_for('upload.process_paths_upload') }}" method="post" enctype="multipart/form-data" class="upload-form">
                <div class="form-group">
                    <label for="paths">Enter File Paths (one per line):</label>
                    <textarea id="paths" name="paths" rows="10" class="form-control" placeholder="C:\path\to\file1.txt&#10;C:\path\to\file2.txt&#10;/path/to/file3.txt"></textarea>
                </div>

                <div class="form-group">
                    <label>Or Upload a File Containing Paths:</label>
                    <input type="file" name="paths_file" accept=".txt,.csv">
                    <small class="form-text text-muted">File should contain one path per line</small>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Process Paths</button>
                </div>
            </form>

            <div class="upload-help">
                <h3>Path List Guidelines</h3>
                <p>When providing a list of paths:</p>
                <ul>
                    <li>Each path should be on a separate line</li>
                    <li>Both absolute and relative paths are supported</li>
                    <li>Windows and Unix-style paths are both acceptable</li>
                    <li>The system will analyze file names, directories, and their relationships</li>
                </ul>
            </div>
        </div>

        <!-- Directory Form -->
        <div class="method-form" id="directory-form" style="display: none;">
            <form action="{{ url_for('upload.process_directory') }}" method="post" class="upload-form">
                <div class="form-group">
                    <label for="directory_path">Directory Path:</label>
                    <input type="text" id="directory_path" name="directory_path" class="form-control" placeholder="C:\Path\to\directory or /path/to/directory">
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Process Directory</button>
                </div>
            </form>

            <div class="upload-help">
                <h3>Directory Processing</h3>
                <p>The system will analyze:</p>
                <ul>
                    <li>Folder structure and hierarchy</li>
                    <li>File metadata (size, type, creation date)</li>
                    <li>Common naming patterns across files and folders</li>
                    <li>Relationships between file components</li>
                </ul>
            </div>
        </div>

        <!-- JSON Input Form -->
        <div class="method-form" id="json-form" style="display: none;">
            <form action="{{ url_for('upload.process_json_input') }}" method="post" class="upload-form">
                <div class="form-group">
                    <label for="json_data">Enter JSON Data:</label>
                    <textarea id="json_data" name="json_data" rows="15" class="form-control" placeholder='{"nodes": [...], "edges": [...]}' spellcheck="false"></textarea>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Process JSON</button>
                </div>
            </form>

            <div class="upload-help">
                <h3>JSON Format Guidelines</h3>
                <p>Your JSON should follow one of these formats:</p>
                <ul>
                    <li><strong>Graph JSON:</strong> Contains "nodes" and "edges" arrays</li>
                    <li><strong>Hierarchical JSON:</strong> Any nested JSON structure will be analyzed as a graph</li>
                    <li><strong>Node-Link Format:</strong> Standard NetworkX or D3.js format</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block additional_css %}
<style>
    .example {
        background-color: #f7f7f7;
        padding: 10px;
        border-radius: 5px;
        font-size: 0.9em;
        overflow-x: auto;
    }
</style>
{% endblock %}

{% block additional_js %}
<script src="{{ url_for('static', filename='js/upload/upload_handler.js') }}"></script>
{% endblock %}
